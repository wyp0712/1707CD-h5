<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
    }

    .wrap {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>



  <div class="wrap">
    <canvas id="myCanvas"> </canvas>
  </div>


  <script src="./ajax.js"></script>
  <script>

    var wrap = document.querySelector('.wrap');
    var myCanvas = document.getElementById('myCanvas');
    myCanvas.width = wrap.offsetWidth;
    myCanvas.height = wrap.offsetHeight;
    var api = myCanvas.getContext('2d');
    var deg = Math.PI / 180;
    var per = 0; // 初始角度
    var totalcount = 0; // 总的数量
    var r = 80;

    api.translate(myCanvas.width / 2,  myCanvas.height / 4);


    ajax('./data.json', (res) => {

      // 3. 计算总数： totalcount
      res.map(item => {
        totalcount += item.count;
      })

      // 4. 计算每一个扇形的度数
      res.forEach(item => {
        var currentDeg = item.count / totalcount * 360 * deg;
        // 5. 绘制图形：
        api.save();
        api.beginPath();
        // api.moveTo(0, 0);
        api.arc(0, 0, r, per, per + currentDeg);
        // api.fillStyle = item.color;
        // api.fill()
        api.lineWidth = 20;
        api.strokeStyle = item.color;
        api.stroke() // 描边  填充
        api.restore()

        //  第一个点： 每一个扇形的中心点
        var x = Math.cos(per + currentDeg / 2) * r;
        var y = Math.sin(per + currentDeg / 2) * r;
        // 第二个点： 每一个大圆扇形的中心点
        var x1 = Math.cos(per + currentDeg / 2) * (r + 10);
        var y1 = Math.sin(per + currentDeg / 2) * (r + 10);
        // 第三个点： 判断 x1 坐标正负  左 - 30 右边 + 30  y
        var x2, y2 = y1;

        x1 > 0 ? x2 = x1 + 10 : x2 = x1 - 10;


        api.save()
        api.beginPath()
        api.moveTo(x, y)
        api.lineTo(x1, y1)
        api.lineTo(x2, y2)
        api.stroke()
        api.restore()

        api.save(); 
        createText(item.name, x2 > 0 ? x2 + 40 : x2 - 40, y2);
        api.restore()
        per += currentDeg
      })
    })

    function createText(text, x, y, dirfont) {
      api.font = '14px Arial';
      api.textAlign = 'center';
      api.textBaseline = 'middle';
      dirfont === 'kong' ? api.strokeText(text, x, y) : api.fillText(text, x, y);
    }






    /*
    # pie：
 var deg = Math.PI / 180
 1. 扇形图
 2. 改变圆心坐标： api.translate(250, 250);
 3. 计算总数： totalcount
 4. 计算每一个扇形的度数 currentDeg =  item.count / totalcount * 360 * deg;
 5. 绘制图形：
   api.save()
   api.beginPath()
   api.arc(0, 0, r, 0, per, per + currentDeg)

   per += currentDeg
 6. 找三个点

   第一个点： 每一个扇形的中心点
   第二个点： 每一个大圆扇形的中心点
   第三个点： 判断 x 坐标正负  左 - 30 右边 + 30  y

    */







  </script>
</body>

</html>