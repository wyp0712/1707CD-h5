<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>



  <script>

    // var myCanvas = document.querySelector('#myCanvas');
    // var api = myCanvas.getContext('2d');

    var imgsArr = ['./1566462442.png', './847e8be64da943b2a59cb5a46fac07c1.jpeg']
    var arr = [];
    imgsArr.forEach(item => {
      arr.push(imageLoad(item))
    })

    // 图片下载
    function downloadImg(url, name) {
      // 将链接地址字符内容转变成blob地址
      fetch(url).then(res => res.blob()).then((blob) => {
        // 创建隐藏的可下载链接
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = URL.createObjectURL(blob);
        a.download = name;
        document.body.appendChild(a);
        a.click();
        // 移除元素
        document.body.removeChild(a);
      });
    }

    // 图片懒加载代码
    function imageLoad(src) {
      return new Promise((resolve, reject) => {
        var img = new Image();
        img.onload = function () {
          resolve(img)
        }
        img.onerror = function () { }
        img.src = src;
      })
    }

    // 批量图片处理
    function downloadIMage(arr) {
      Promise.all(arr).then(list => {
        var myCanvas = document.createElement('canvas');
        myCanvas.width = 300;
        myCanvas.height = 300;
        document.documentElement.appendChild(myCanvas);
        var api = myCanvas.getContext('2d');
        api.drawImage(list[0], 0, 0);
        api.drawImage(list[1], 60, 60, 100, 100);
        console.log(myCanvas.toDataURL())
        downloadImg(myCanvas.toDataURL(), 'a')
      })
    }
    downloadIMage(arr)


    // 图片合成函数
    function ImageSynthesis() {

    }

    ImageSynthesis.prototype = {
      init: function () { },
      // 批量图片处理
      downloadIMage(arr) {
        Promise.all(arr).then(list => {
          var myCanvas = document.createElement('canvas');
          myCanvas.width = 300;
          myCanvas.height = 300;
          document.documentElement.appendChild(myCanvas);
          var api = myCanvas.getContext('2d');
          api.drawImage(list[0], 0, 0);
          api.drawImage(list[1], 60, 60, 100, 100);
          console.log(myCanvas.toDataURL())
          downloadImg(myCanvas.toDataURL(), 'a')
        })
      },
      // 图片懒加载代码
      imageLoad(src) {
        return new Promise((resolve, reject) => {
          var img = new Image();
          img.onload = function () {
            resolve(img)
          }
          img.onerror = function () { }
          img.src = src;
        })
      },
      // 图片下载
      downloadImg(url, name) {
        // 将链接地址字符内容转变成blob地址
        fetch(url).then(res => res.blob()).then((blob) => {
          // 创建隐藏的可下载链接
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = URL.createObjectURL(blob);
          a.download = name;
          document.body.appendChild(a);
          a.click();
          // 移除元素
          document.body.removeChild(a);
        });
      }
    }

    // new ImageSynthesis()














    // var imgsArr = ['./1566462442.png', './847e8be64da943b2a59cb5a46fac07c1.jpeg']
    // imgsArr.forEach(item => {

      // Promise.all(item)
      // .then(res => {
      //   console.log(res, 'res')
      // })
      // .then(resImg => {
      //   console.log(resImg, 'resImg')
      //   api.drawImage(resImg[0], 0, 0);
      //   api.drawImage(resImg[1], 20, 20);
      //   imgs.src = myCanvas.toDataURL()
      // })
    // })







    // function getBase64(url, callback) {
    //   //通过构造函数来创建的 img 实例，在赋予 src 值后就会立刻下载图片，相比 createElement() 创建 <img> 省去了 append()，也就避免了文档冗余和污染
    //   var Img = new Image(),
    //     dataURL = '';
    //   Img.src = url;
    //   console.log(Img, 'Imag')
    //   Img.onload = function () { //要先确保图片完整获取到，这是个异步事件
    //     var canvas = document.createElement("canvas"), //创建canvas元素
    //       width = Img.width, //确保canvas的尺寸和图片一样
    //       height = Img.height;
    //     canvas.width = width;
    //     canvas.height = height;
    //     canvas.getContext("2d").drawImage(Img, 0, 0, width, height); //将图片绘制到canvas中
    //     dataURL = canvas.toDataURL(); //转换图片为dataURL
    //     // callback ? callback(dataURL) : null; //调用回调函数
    //   };
    // }

    // getBase64('http://p0.meituan.net/128.180/movie/005955214d5b3e50c910d7a511b0cb571445301.jpg',function(res) {
    //   console.log(res)
    // })

  </script>
</body>

</html>